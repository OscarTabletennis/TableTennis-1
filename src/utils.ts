import type { DB, Player } from './types'
export function uid(): string { return Math.random().toString(36).slice(2) + Date.now().toString(36) }
export function dateToday(): string { const d=new Date(); const m=String(d.getMonth()+1).padStart(2,'0'); const day=String(d.getDate()).padStart(2,'0'); return `${d.getFullYear()}-${m}-${day}` }
export function playerName(players: Player[], id: string): string { return players.find(p=>p.id===id)?.name ?? 'Unknown' }
export function computeStandings(db: DB){ const map=new Map<string,{name:string;gp:number;w:number;l:number;setDiff:number;recent:string[]}>(); db.players.forEach(p=>map.set(p.id,{name:p.name,gp:0,w:0,l:0,setDiff:0,recent:[]})); for(const m of db.matches){const a=map.get(m.aId),b=map.get(m.bId); if(!a||!b) continue; a.gp++; b.gp++; a.setDiff+=m.aSets-m.bSets; b.setDiff+=m.bSets-m.aSets; if(m.aSets>m.bSets){a.w++; b.l++; a.recent.push('W'); b.recent.push('L')}else{b.w++; a.l++; b.recent.push('W'); a.recent.push('L')} a.recent=a.recent.slice(-5); b.recent=b.recent.slice(-5)} const rows=[...map.entries()].map(([id,v])=>({id,...v,winPct:v.gp? v.w/v.gp:0})); rows.sort((r1,r2)=> r2.winPct-r1.winPct || r2.setDiff-r1.setDiff || r1.name.localeCompare(r2.name)); return rows }
